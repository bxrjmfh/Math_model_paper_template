建立

# 矿料体积模型
传统的摄像机只能捕捉图像的色彩，以及对应的通道信息，就相机本身而言不具有采集距离信息的能力。在没有事先标定点的情况下，通过图片信息确定空间中某个点的位置坐标较为困难。但是在矿料和地面或是墙壁的交界处具有明暗对比，可以通过边缘检测算法提取边缘信息，再结合矿料的物理性质建立矿料体积模型。

考虑仓库中的矿料堆放情况，如图（\ref{kuang_1}）所示。仓库后侧为墙体，左右两侧为高为$h_0$的隔墙，左右围墙之间距离为$d$，前方为矿料流动形成的斜坡，斜坡底部与地面形成地面边缘$E_G$。由于存在采用矿料的情况，地面边缘$E_G$可能呈现不规则的形状。

pic

首先我们需要指定摄像头在仓库中的位置。为了实时检测仓库的矿料体积，我们使用两个摄像头获取图像信息，上传至管理平台。两个摄像头分别位于仓库顶部以及仓库正面，分别拍摄仓库的俯视图与正视图。如图（\ref{camera_lay}）中所示：

pic

在得到正视图以及俯视图后，我们需要进行边缘提取工作。边缘提取是计算机视觉领域较为成熟的一个领域，相当多边缘检测的算法被投入使用。考虑到现有条件下建立精确三维模型的困难之处，我们利用俯视图以及正视图中的边缘信息，还原矿料堆放的形状。从正视图中可以提取出矿料在后方墙体上的边缘投影$z=H_W(x)$，这有利于我们得到矿料整体高度。从俯视图中可以提取矿料的地面边缘信息$y=E_G(x)$。

常见的的边缘检测算法\cite{bianyuan}有：使用Robort，Laplace，Sobel算子作为卷积核，在图像上进行滑动从而提取出边缘响应。此外还有若干基于模糊推理以及小波检测的方法，鉴于计算复杂性，我们采用Sobel算子（如图\ref{sobel}）进行边缘信息提取。

pic sobel算子示意图

在提取矿料边缘之后，我们将利用矿料地面边缘$E_G$,矿料墙体边缘$E_W$建立矿料体积模型。考虑到矿料位于四个平面之间，有两个面形状不规则，但利用矿料地面边缘$E_G$与墙壁信息可以计算出矿料的底面积大小，利用矿料墙体边缘$H_W$可以估计矿料堆放高度。再利用已知矿料的休止角$\theta$大小，可以建立以下体积计算公式：

equa
$V=0.5*int_0^d H_W(x)*(2E_G(x)-\frac{H_W(x)}{tan(\theta)})$

，其中$V$是矿料体积，x轴沿垂直于两面隔墙的方向，$\theta$是不同矿料的休止角。

# 堆放余量模型
我们首先考虑仓库中没有任何矿料的情况，此时$V=0$。在这一情况下，矿料装满后仓库侧视图如图（\ref{kuang_2} a）所示，此时$H_W(x)=h_0$且$E_G(x)=L_0$，$L_0$是仓库长度。

在仓库不空的情况下，由于已有的矿料占据了仓库空间，使得已经堆放的矿料上方的空间得不到利用。此时仓库剩余体积$V_{remain}$不能使用总体积$V_0$与矿料体积$V$相减获得。此时剩余体积如图(\ref{kuang_2} b)中的红色部分所示.矿车在地面边缘$E_G$部分下料,填补原有矿料角度（部分1），在填平之后继续堆放高度至$h_0$，此时产生高低界面之间的斜坡（部分2），最终将仓库靠近出口处的剩余体积补齐（部分3），此时装填整个仓库。

kuang_2 a,b
不同情况下的矿料剩余体积（侧视图）

综合上述分析，我们提出矿料剩余体积计算公式：

V_{remain}=\begin{cases}V_0=0.5*d*h_0*(2L_0-\frac{h_0}{tan(\theta)}),仓库为空\\\frac{h_0^2}{2*tan\theta}+0.5*int_0^d H_W(x)*(2(L_0-E_G(x))-\frac{h_0}{tan\theta})*
    \end{cases}





