# 1
考虑自卸车卸下矿料的过程，在模型假设中，我们将自卸车看作是一个高度大于3米的漏斗。我们若是考虑矿料为刚性材料，那么卸下后形状不会发生变化，此时矿料形状为一个均匀的长方体，如图（\ref{heap}）所示。事实上，考虑矿料的静止角等因素，该状态可以作为矿料堆放的初始状态。也就是说，在矿料倾倒下来的瞬间，矿料是长方体，在随后的一小段时间内遵循物理规律下落坍塌，形成坡面。

矿料堆放瞬间图片heap

该长方体的几何尺寸取决于大小自卸车的货厢参数，我们将在模型求解中给出具体尺寸。

前人在矿料等微粒集合体现出的宏观形状做出了许多研究，Yamakita\cite{waji}等人在使用挖掘机模型转移土壤的过程中，利用二维高斯函数拟合现实中沙子的堆放形状，Nuca\cite{paowuxian}等人提出退化的抛物线模型，对模拟沙子流动的行为做出了较好的建模，Song\cite{hesha}等人考虑了在河流冲刷外力作用的情况下沙子堆放形状问题。

在前人研究的启发之下，我们提出一种基于离散迭代的元胞自动机方法，建立矿料形状的物理模型。其理论基础如下：

矿料某点处的矿料稳定与否，取决于矿料在这点处的方向导数$\frac{\partial h}{\partial l}$与休止角正切值的大小关系$tan\theta$。若方向导数值大于休止角正切值，则该点不稳定，会发生坍塌。

\frac{\partial h}{\partial l}\leq tan\theta

我们定义坍塌为矿料不稳定点与相邻矿料点之间的物质转移情况。该转移过程中保持矿料体积不变，转移的方向沿该点高度值的负梯度方向。每次转移的数量为\textcolor{red}{待定}。

我们对目前矿料上的每个点计算方向导数，按照方向导数从大到小的顺序进行坍塌结果计算。上述步骤称为一次形状迭代，形状迭代之后可能仍然不能使所有点都满足休止角的条件。因此迭代过程可能还需要再进行数次。

在迭代终止之后，我们便获得矿料堆放的最终形状。

考虑连续模型计算的困难性，我们结合元胞自动机的基本理论，提出离散的矿料物理模型。该模型将连续的矿料立方体网格化，将其分割为离散格点，格点上具有高度信息。我们利用格点高度矩阵$H$存储高度信息。如图(\ref{wangge})对于每个格点，根据其周围格点的相对高度，具有以下行为特征：

wangge
网格图像，以及局部细节（五个格子的立体图）

离散化梯度计算，使用差分代替求导。某个格点$V_0$在各个方向的梯度使用各个方向上的高度差$\delta h$与网格边长$a$之比计算，我们称之为离散梯度$p$格点是否发生坍塌，依然取决于下式：

p=\frac{\delta h}{a}\leq tan\theta

在网格边界处设置边界高度为无穷，此时离散梯度$\frac{\delta h}{a}$恒小于休止角$tan\theta$，也就是不会坍塌至边界以外。

考虑到元胞自动机的有限行为特点，坍塌时候发生物质转移只在当前网格的四邻域方向进行。基于当前点和周围点的高度信息，我们可以计算并记录四个方向的离散梯度，我们使用梯度数组$P$维护：

P=[\frac{\delta h_{up}}{a},\delta h_{down}}{a},\delta h_{left}}{a},\delta h_{right}}{a}]

我们对每个方向上的离散梯度$p$与休止角正切值$tan\theta$比较，得到坍塌方向数$N$:

N=|\{p|p>tan\theta,p\in P\}|

若梯度数组中数值都小于休止角正切值$tan\theta$，也就是$N=0$的情况下，该点不发生坍塌。下面重点讨论$N \laq 1$的情况：

此时约束条件有以下三条：

当前格点处可能向周围不满足休止角的方向进行坍塌，坍塌至$p<tan\theta$。每个方向上都可能发生坍塌，且当前格点$V_0$的高度$h_{v0}$不会因为坍塌而低于周围格点。当前格点以及周围格点的高度之和不会发生改变。

在上述约束条件下，我们得到高度更新公式：

h_{v0} + a*\sum p =h^*_{v0}+N^*(h^*_{v0}-tan\theta)
p* = h_{v0}^* -tan\theta

在上述规则下进行迭代，直至满足以下条件时终止迭代。

百分之九十的格点已经稳定（$N=0$）。
网格中最大格点高度小于仓库高度$h_0$


# 调度模型建立

为了使仓库装载矿料尽可能多，我们需要实时计算最佳的卸货位置以及最佳的卸货车型，以实现最终堆放的体积最大。因为我们是在已有部分矿料的仓库中中继续填，在自卸车加入新的矿料之后，形成的形状并不是对应点高度的简单相加。也就是说每次卸料的结果都与当前仓库矿料的堆放状态有关。

同时我们发现，仓库的界限（如地面、隔墙等）是平整的，且不能有矿料溢出。加之矿料堆放的物理模型中，我们规定矿料堆放到$h_0$,也就是仓库隔墙的高度。所以只要保证每次卸货的结果都尽量维持地面边缘的平整，那么最后就可以使得仓库装料体积最大。

下面介绍如何选择最佳卸货位置。在矿料体积模型中，我们采用计算机视觉方法提取矿料的地面边缘$E_G$。在矿料物理模型中我们已将靠墙情况下的自卸车在平地上的堆放结果（如图\ref{chedui}）模拟出来。我们将这一堆放结果轮廓称为$S$。

chedui 平地上靠墙的的堆放结果

向已经堆放矿料的仓库中卸货时，“漏斗”边缘位置受到原有矿料的影响，只能在矿料的地面边缘的一段距离$d$之内，如图(\ref{kuangbian})，也就是说自卸车能够深入仓库的距离$d$是有限的。

kuangbian漏斗边缘和矿料边缘的位置示意图

为了计算极限距离$d$，我们需要考虑自卸车的离去角$\alpha$与休止角$\theta$之间的关系。车辆的离去角定义为车满载时自车身后端突出点向后车轮引切线与路面之间的夹角\cite{liqu}。

主要分为两种情况，如图(\ref{liqu})：

当自卸车离去角较小、小于矿料的安息角时，卸货的深度只受物料安息角车和货箱最低点的高度影响，这是小型自卸车的情况。
自卸车的离去角较大，货的轮子会先触碰到矿料，而货箱不会触碰矿料。

大小车辆离去角liqu

经查阅资料，小车的货箱最低点高度$h_{small} = 0.98m$ ，离去角$\alpha_{small} =23\deg$，细矿砂休止角$\theta_{f}=30\deg$，所以小型自卸车货箱边界能够深入已有细矿料边界的距离为：
d_{small,f} = \frac{h_{small}}{tan\theta_{f}}=1.66m
；对于粗砂，其安息角更大，同理可以计算得到：
d_{small,c} = \frac{h_{small}}{tan\theta_{c}}=0.98m

对于大自卸车而言,无论是粗料还是细料都达不到离去角，因此$d_{big}$使用下式进行计算：
d_{big} = \frac{H_{big}}{tan\alpha{big}}

,算得到$d_{big}=1.09m$。

虽然矿料的堆放是一个三维立体模型，但是因为假设1中，已有矿料的角度统一为安息角，且边界基本规整。因此我们可以将此三维模型抽象成一个二维模型，即只考虑其俯视图，只考虑边界的形状。我们用第一问靠墙堆放情况下的坍塌模型得到的边界为匹配目标，因为虽然不同情况下重叠堆放出来的堆的形状会发生变化，但因为卸货车卸货深度的限制，其最终结果应与靠墙堆放相似。

在确定大小车辆在不同矿料条件下的极限距离$d$之后，我们使用边界相似的方法最佳位置。该方法首先将已有矿料的地面边缘$E_G$分为等距网格下的100个点为采样点，为了计算边界相似度。从第一问的靠墙坍塌情况下模拟会得到一个边界图（图\ref{chedui}），我们以此为目标形状的外边界$S$，在距离外边界卸货车深入矿物的最大距离$d$处记录内部边界$S’$内外边界之间形成模板，我们在等距网格上移动这一模板，并且保持内边界紧贴已有矿料地面边缘$E_G$，并且使外边界在仓库出口边界以内，不断移动模板，这样我们会得到100个模板响应$R_i$。

模板响应$R$的计算方法为：计算目标图形在每次移动中的内外边界$SS’$所围区域内原有矿料含有地面边缘$E_G$采样点的个数$n$，与轮廓的周长$c(S)$的比值$Rk,i=nk,i/C(S_k)$（i为测试点序号，k为大小车的标号），作为边界相似度的度量。最后得到200个响应值$R$，大车、小车各100个，我们以$S$值最大的测试点位置为最佳位置，同时以其需要的车型号为此位置对应的最佳车型。

因为坍塌模型的计算较迅速，我们每次确定最佳卸货位置后都可以检测新的边缘信息，完成矿料体积以及边界迭代。 每次车辆装卸完成后，再次利用识别系统得到以下状态变化信息$V_{remian}^*$,$E_G^*$：

V_{remian}^*=V^*_{remian}+V_{cargo}




